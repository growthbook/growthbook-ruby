<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Growthbook::Util
  
    &mdash; Documentation by YARD 0.9.34
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Growthbook::Util";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (U)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Growthbook.html" title="Growthbook (module)">Growthbook</a></span></span>
     &raquo; 
    <span class="title">Util</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Growthbook::Util
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Growthbook::Util</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/growthbook/util.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>internal use only</p>


  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#check_rule-class_method" title="check_rule (class method)">.<strong>check_rule</strong>(actual, op, desired)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#choose_variation-class_method" title="choose_variation (class method)">.<strong>choose_variation</strong>(n, ranges)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Chose a variation based on a hash and range.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#choose_variation_for_user-class_method" title="choose_variation_for_user (class method)">.<strong>choose_variation_for_user</strong>(user_id, experiment)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_bucket_ranges-class_method" title="get_bucket_ranges (class method)">.<strong>get_bucket_ranges</strong>(num_variations, coverage = 1, weights = [])  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Determine bucket ranges for experiment variations.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_equal_weights-class_method" title="get_equal_weights (class method)">.<strong>get_equal_weights</strong>(num_variations)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_query_string_override-class_method" title="get_query_string_override (class method)">.<strong>get_query_string_override</strong>(id, url, num_variations)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get an override variation from a url querystring e.g.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#hash-class_method" title="hash (class method)">.<strong>hash</strong>(str)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#in_namespace-class_method" title="in_namespace (class method)">.<strong>in_namespace</strong>(user_id, namespace)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="check_rule-class_method">
  
    .<strong>check_rule</strong>(actual, op, desired)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/growthbook/util.rb', line 10</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_check_rule'>check_rule</span><span class='lparen'>(</span><span class='id identifier rubyid_actual'>actual</span><span class='comma'>,</span> <span class='id identifier rubyid_op'>op</span><span class='comma'>,</span> <span class='id identifier rubyid_desired'>desired</span><span class='rparen'>)</span>
  <span class='comment'># Check if both strings are numeric so we can do natural ordering
</span>  <span class='comment'># for greater than / less than operators
</span>  <span class='id identifier rubyid_numeric'>numeric</span> <span class='op'>=</span> <span class='kw'>begin</span>
    <span class='lparen'>(</span><span class='op'>!</span><span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_actual'>actual</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_desired'>desired</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='const'>StandardError</span>
    <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='kw'>case</span> <span class='id identifier rubyid_op'>op</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>=</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_numeric'>numeric</span> <span class='op'>?</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_actual'>actual</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_d'>to_d</span> <span class='op'>==</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_desired'>desired</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_d'>to_d</span> <span class='op'>:</span> <span class='id identifier rubyid_actual'>actual</span> <span class='op'>==</span> <span class='id identifier rubyid_desired'>desired</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>!=</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_numeric'>numeric</span> <span class='op'>?</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_actual'>actual</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_d'>to_d</span> <span class='op'>!=</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_desired'>desired</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_d'>to_d</span> <span class='op'>:</span> <span class='id identifier rubyid_actual'>actual</span> <span class='op'>!=</span> <span class='id identifier rubyid_desired'>desired</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&gt;</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_numeric'>numeric</span> <span class='op'>?</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_actual'>actual</span><span class='rparen'>)</span> <span class='op'>&gt;</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_desired'>desired</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id identifier rubyid_actual'>actual</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_desired'>desired</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&lt;</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_numeric'>numeric</span> <span class='op'>?</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_actual'>actual</span><span class='rparen'>)</span> <span class='op'>&lt;</span> <span class='const'>Float</span><span class='lparen'>(</span><span class='id identifier rubyid_desired'>desired</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id identifier rubyid_actual'>actual</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_desired'>desired</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>~</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>begin</span>
      <span class='op'>!</span><span class='op'>!</span><span class='lparen'>(</span><span class='id identifier rubyid_actual'>actual</span> <span class='op'>=~</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_desired'>desired</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='const'>StandardError</span>
      <span class='kw'>false</span>
    <span class='kw'>end</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>!~</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_actual'>actual</span> <span class='op'>!~</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_desired'>desired</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='const'>StandardError</span>
      <span class='kw'>false</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='kw'>true</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="choose_variation-class_method">
  
    .<strong>choose_variation</strong>(n, ranges)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Chose a variation based on a hash and range</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


114
115
116
117
118
119</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/growthbook/util.rb', line 114</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_choose_variation'>choose_variation</span><span class='lparen'>(</span><span class='id identifier rubyid_n'>n</span><span class='comma'>,</span> <span class='id identifier rubyid_ranges'>ranges</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ranges'>ranges</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_range'>range</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_i'>i</span> <span class='kw'>if</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_range'>range</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_range'>range</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='op'>-</span><span class='int'>1</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="choose_variation_for_user-class_method">
  
    .<strong>choose_variation_for_user</strong>(user_id, experiment)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/growthbook/util.rb', line 45</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_choose_variation_for_user'>choose_variation_for_user</span><span class='lparen'>(</span><span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span> <span class='id identifier rubyid_experiment'>experiment</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_test_id'>test_id</span> <span class='op'>=</span> <span class='id identifier rubyid_experiment'>experiment</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
  <span class='id identifier rubyid_weights'>weights</span> <span class='op'>=</span> <span class='id identifier rubyid_experiment'>experiment</span><span class='period'>.</span><span class='id identifier rubyid_getScaledWeights'>getScaledWeights</span>

  <span class='comment'># Hash the user id and testName to a number from 0 to 1
</span>  <span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='const'>FNV</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_fnv1a_32'>fnv1a_32</span><span class='lparen'>(</span><span class='id identifier rubyid_user_id'>user_id</span> <span class='op'>+</span> <span class='id identifier rubyid_test_id'>test_id</span><span class='rparen'>)</span> <span class='op'>%</span> <span class='int'>1000</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='float'>1000.0</span>

  <span class='id identifier rubyid_cumulative_weight'>cumulative_weight</span> <span class='op'>=</span> <span class='int'>0</span>

  <span class='id identifier rubyid_match'>match</span> <span class='op'>=</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='id identifier rubyid_i'>i</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_weights'>weights</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_weight'>weight</span><span class='op'>|</span>
    <span class='id identifier rubyid_cumulative_weight'>cumulative_weight</span> <span class='op'>+=</span> <span class='id identifier rubyid_weight'>weight</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_cumulative_weight'>cumulative_weight</span>
      <span class='id identifier rubyid_match'>match</span> <span class='op'>=</span> <span class='id identifier rubyid_i'>i</span>
      <span class='kw'>break</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_i'>i</span> <span class='op'>+=</span> <span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_match'>match</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_bucket_ranges-class_method">
  
    .<strong>get_bucket_ranges</strong>(num_variations, coverage = 1, weights = [])  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Determine bucket ranges for experiment variations</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/growthbook/util.rb', line 88</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_bucket_ranges'>get_bucket_ranges</span><span class='lparen'>(</span><span class='id identifier rubyid_num_variations'>num_variations</span><span class='comma'>,</span> <span class='id identifier rubyid_coverage'>coverage</span> <span class='op'>=</span> <span class='int'>1</span><span class='comma'>,</span> <span class='id identifier rubyid_weights'>weights</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='comment'># Make sure coverage is within bounds
</span>  <span class='id identifier rubyid_coverage'>coverage</span> <span class='op'>=</span> <span class='int'>1</span> <span class='kw'>if</span> <span class='id identifier rubyid_coverage'>coverage</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='id identifier rubyid_coverage'>coverage</span> <span class='op'>=</span> <span class='int'>0</span> <span class='kw'>if</span> <span class='id identifier rubyid_coverage'>coverage</span><span class='period'>.</span><span class='id identifier rubyid_negative?'>negative?</span>
  <span class='id identifier rubyid_coverage'>coverage</span> <span class='op'>=</span> <span class='int'>1</span> <span class='kw'>if</span> <span class='id identifier rubyid_coverage'>coverage</span> <span class='op'>&gt;</span> <span class='int'>1</span>

  <span class='comment'># Default to equal weights
</span>  <span class='id identifier rubyid_weights'>weights</span> <span class='op'>=</span> <span class='id identifier rubyid_get_equal_weights'>get_equal_weights</span><span class='lparen'>(</span><span class='id identifier rubyid_num_variations'>num_variations</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_weights'>weights</span> <span class='op'>||</span> <span class='id identifier rubyid_weights'>weights</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>!=</span> <span class='id identifier rubyid_num_variations'>num_variations</span>

  <span class='comment'># If weights don&#39;t add up to 1 (or close to it), default to equal weights
</span>  <span class='id identifier rubyid_total'>total</span> <span class='op'>=</span> <span class='id identifier rubyid_weights'>weights</span><span class='period'>.</span><span class='id identifier rubyid_sum'>sum</span>
  <span class='id identifier rubyid_weights'>weights</span> <span class='op'>=</span> <span class='id identifier rubyid_get_equal_weights'>get_equal_weights</span><span class='lparen'>(</span><span class='id identifier rubyid_num_variations'>num_variations</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_total'>total</span> <span class='op'>&lt;</span> <span class='float'>0.99</span> <span class='op'>||</span> <span class='id identifier rubyid_total'>total</span> <span class='op'>&gt;</span> <span class='float'>1.01</span>

  <span class='comment'># Convert weights to ranges
</span>  <span class='id identifier rubyid_cumulative'>cumulative</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_ranges'>ranges</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_weights'>weights</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_w'>w</span><span class='op'>|</span>
    <span class='id identifier rubyid_start'>start</span> <span class='op'>=</span> <span class='id identifier rubyid_cumulative'>cumulative</span>
    <span class='id identifier rubyid_cumulative'>cumulative</span> <span class='op'>+=</span> <span class='id identifier rubyid_w'>w</span>
    <span class='id identifier rubyid_ranges'>ranges</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='id identifier rubyid_start'>start</span><span class='comma'>,</span> <span class='id identifier rubyid_start'>start</span> <span class='op'>+</span> <span class='lparen'>(</span><span class='id identifier rubyid_coverage'>coverage</span> <span class='op'>*</span> <span class='id identifier rubyid_w'>w</span><span class='rparen'>)</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_ranges'>ranges</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_equal_weights-class_method">
  
    .<strong>get_equal_weights</strong>(num_variations)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


77
78
79
80
81
82
83
84
85</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/growthbook/util.rb', line 77</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_equal_weights'>get_equal_weights</span><span class='lparen'>(</span><span class='id identifier rubyid_num_variations'>num_variations</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_num_variations'>num_variations</span> <span class='op'>&lt;</span> <span class='int'>1</span>

  <span class='id identifier rubyid_weights'>weights</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='lparen'>(</span><span class='int'>1</span><span class='op'>..</span><span class='id identifier rubyid_num_variations'>num_variations</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__i'>_i</span><span class='op'>|</span>
    <span class='id identifier rubyid_weights'>weights</span> <span class='op'>&lt;&lt;</span> <span class='lparen'>(</span><span class='float'>1.0</span> <span class='op'>/</span> <span class='id identifier rubyid_num_variations'>num_variations</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_weights'>weights</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_query_string_override-class_method">
  
    .<strong>get_query_string_override</strong>(id, url, num_variations)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get an override variation from a url querystring e.g. <a href="http://localhost?my-test=1">localhost?my-test=1</a> will return ‘1` for id `my-test`</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/growthbook/util.rb', line 123</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_query_string_override'>get_query_string_override</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_url'>url</span><span class='comma'>,</span> <span class='id identifier rubyid_num_variations'>num_variations</span><span class='rparen'>)</span>
  <span class='comment'># Skip if url is empty
</span>  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_url'>url</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>

  <span class='comment'># Parse out the query string
</span>  <span class='id identifier rubyid_parsed'>parsed</span> <span class='op'>=</span> <span class='const'>URI</span><span class='lparen'>(</span><span class='id identifier rubyid_url'>url</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_parsed'>parsed</span><span class='period'>.</span><span class='id identifier rubyid_query'>query</span>

  <span class='id identifier rubyid_qs'>qs</span> <span class='op'>=</span> <span class='const'>URI</span><span class='period'>.</span><span class='id identifier rubyid_decode_www_form'>decode_www_form</span><span class='lparen'>(</span><span class='id identifier rubyid_parsed'>parsed</span><span class='period'>.</span><span class='id identifier rubyid_query'>query</span><span class='rparen'>)</span>

  <span class='comment'># Look for `id` in the querystring and get the value
</span>  <span class='id identifier rubyid_vals'>vals</span> <span class='op'>=</span> <span class='id identifier rubyid_qs'>qs</span><span class='period'>.</span><span class='id identifier rubyid_assoc'>assoc</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_vals'>vals</span>

  <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='id identifier rubyid_vals'>vals</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_val'>val</span>

  <span class='comment'># Parse the value as an integer
</span>  <span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='kw'>begin</span>
    <span class='const'>Integer</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='const'>StandardError</span>
    <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='comment'># Make sure the integer is within range
</span>  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_n'>n</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_n'>n</span><span class='period'>.</span><span class='id identifier rubyid_negative?'>negative?</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_num_variations'>num_variations</span>

  <span class='id identifier rubyid_n'>n</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="hash-class_method">
  
    .<strong>hash</strong>(str)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


68
69
70</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/growthbook/util.rb', line 68</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_hash'>hash</span><span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='rparen'>)</span>
  <span class='lparen'>(</span><span class='const'>FNV</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_fnv1a_32'>fnv1a_32</span><span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='rparen'>)</span> <span class='op'>%</span> <span class='int'>1000</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='float'>1000.0</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="in_namespace-class_method">
  
    .<strong>in_namespace</strong>(user_id, namespace)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


72
73
74
75</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/growthbook/util.rb', line 72</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_in_namespace'>in_namespace</span><span class='lparen'>(</span><span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span> <span class='id identifier rubyid_namespace'>namespace</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='id identifier rubyid_hash'>hash</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_user_id'>user_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>__</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_namespace'>namespace</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_n'>n</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_namespace'>namespace</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_namespace'>namespace</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Wed Apr 19 00:45:09 2023 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.34 (ruby-3.2.2).
</div>

    </div>
  </body>
</html>